<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyzing network scale-up data using the networkreporting package • networkreporting</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing network scale-up data using the networkreporting package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">networkreporting</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/network_scaleup.html">Analyzing network scale-up data using the networkreporting package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyzing network scale-up data using the networkreporting package</h1>
                        <h4 data-toc-skip class="author">Dennis M.
Feehan</h4>
            
            <h4 data-toc-skip class="date">2026-02-25</h4>
      

      <div class="d-none name"><code>network_scaleup.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>networkreporting</strong> package has several tools for
analyzing survey data that have been collected using the network
scale-up method.</p>
<p>This introduction will assume that you already have the
<strong>networkreporting</strong> package installed. If you don’t,
please refer to the introductory vignette (“getting started”) for
instructions on how to do this.</p>
</div>
<div class="section level2">
<h2 id="review-of-the-network-scale-up-method">Review of the network scale-up method<a class="anchor" aria-label="anchor" href="#review-of-the-network-scale-up-method"></a>
</h2>
<p>For the purposes of this vignette, we’ll assume that you have
conducted a survey using network scale-up questions in order to estimate
the size of a hidden population. Analytically, using the scale-up
estimator involves two steps:</p>
<ul>
<li>step 1: estimating the size of the survey respondents’ personal
networks (their <em>degrees</em>)</li>
<li>step 2: estimating the size of the hidden population by combining
the estimated network sizes (from step 1) with the number of connections
to the hidden population</li>
</ul>
<p>We’ll quickly review each of these steps, and then we’ll show how to
use the package to carry the estimation out.</p>
<div class="section level3">
<h3 id="step-1-estimating-network-sizes">Step 1: estimating network sizes<a class="anchor" aria-label="anchor" href="#step-1-estimating-network-sizes"></a>
</h3>
<p>Here, we will use the <em>known population</em> estimator for
respondents’ degrees (Killworth et al., 1998; Feehan and Salganik,
2016). In order to estimate the degree of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
th survey respondent, we use</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mover><msub><mi>d</mi><mi>i</mi></msub><mo accent="true">̂</mo></mover><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>×</mo><mfrac><mi>N</mi><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>N</mi><mi>j</mi></msub></mrow></mfrac><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
\label{eqn:kpdegree}
\hat{d_i} = \sum_{j=1}^{K} y_{ij} \times 
\frac{N}{\sum_{j=1}^{K} N_j},
\end{align}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the total size of the population,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>j</mi></msub><annotation encoding="application/x-tex">N_j</annotation></semantics></math>
is the size of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
th population of known size, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{ij}</annotation></semantics></math>
is the number of connections that survey respondent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
reports between herself and members of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
th population of known size.</p>
</div>
<div class="section level3">
<h3 id="step-2-estimating-hidden-population-sizes">Step 2: estimating hidden population sizes<a class="anchor" aria-label="anchor" href="#step-2-estimating-hidden-population-sizes"></a>
</h3>
<p>Once we have the estimates of the respondents’ degrees, we use them
to produce an estimate for the size of the hidden population:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mover><mi>N</mi><mo accent="true">̂</mo></mover><mi>h</mi></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>s</mi></mrow></munder><msub><mi>y</mi><mrow><mi>i</mi><mi>h</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>s</mi></mrow></munder><mover><msub><mi>d</mi><mi>i</mi></msub><mo accent="true">̂</mo></mover></mrow></mfrac><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
\label{eqn:nsum}
\hat{N}_h = \frac{ \sum_{i \in s} y_{ih} }{ \sum_{i \in s} \hat{d_i} },
\end{align}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>h</mi></msub><annotation encoding="application/x-tex">N_h</annotation></semantics></math>
is the size of the population of interest (which we want to estimate),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
is the set of respondents in our sample, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><msub><mi>d</mi><mi>i</mi></msub><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{d_i}</annotation></semantics></math>
is the estimate of the size of respondent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
degree, obtained using the known population method.</p>
</div>
</div>
<div class="section level2">
<h2 id="preparing-data">Preparing data<a class="anchor" aria-label="anchor" href="#preparing-data"></a>
</h2>
<p>In order to use the package, we will assume that you start with two
datasets: the first is a survey containing information collected from
respondents about their personal networks; the second is information
about the sizes of several populations.</p>
<p>The example data for this vignette are provided with the
<code>networkreporting</code> package, and can be loaded by typing</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dennisfeehan.org/networkreporting/">networkreporting</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">surveybootstrap</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## column names for connections to hidden population numbers</span></span>
<span><span class="va">hidden.q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex.workers"</span>, <span class="st">"msm"</span>, <span class="st">"idu"</span>, <span class="st">"clients"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## column names for connections to groups of known size</span></span>
<span><span class="va">hm.q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"widower"</span>, <span class="st">"nurse.or.doctor"</span>, <span class="st">"male.community.health"</span>, <span class="st">"teacher"</span>, </span>
<span>          <span class="st">"woman.smoke"</span>, <span class="st">"priest"</span>, <span class="st">"civil.servant"</span>, <span class="st">"woman.gave.birth"</span>, </span>
<span>          <span class="st">"muslim"</span>, <span class="st">"incarcerated"</span>, <span class="st">"judge"</span>, <span class="st">"man.divorced"</span>, <span class="st">"treatedfortb"</span>, </span>
<span>          <span class="st">"nsengimana"</span>, <span class="st">"murekatete"</span>, <span class="st">"twahirwa"</span>, <span class="st">"mukandekezi"</span>, <span class="st">"nsabimana"</span>, </span>
<span>          <span class="st">"mukamana"</span>, <span class="st">"ndayambaje"</span>, <span class="st">"nyiraneza"</span>, <span class="st">"bizimana"</span>, <span class="st">"nyirahabimana"</span>, </span>
<span>          <span class="st">"ndagijimana"</span>, <span class="st">"mukandayisenga"</span>, <span class="st">"died"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## size of the entire population</span></span>
<span><span class="va">tot.pop.size</span> <span class="op">&lt;-</span> <span class="fl">10718378</span></span></code></pre></div>
<p>The example data include two datasets: one has all of the responses
from a network scale-up survey, and the other has the known population
sizes for use with the known population estimator.</p>
<div class="section level3">
<h3 id="preparing-the-known-population-data">Preparing the known population data<a class="anchor" aria-label="anchor" href="#preparing-the-known-population-data"></a>
</h3>
<p>The demo known population data are in
<code>example.knownpop.dat</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example.knownpop.dat</span></span></code></pre></div>
<pre><code><span><span class="co">##               known.popn   size</span></span>
<span><span class="co">## 1                widower  36147</span></span>
<span><span class="co">## 2        nurse.or.doctor   7807</span></span>
<span><span class="co">## 3  male.community.health  22000</span></span>
<span><span class="co">## 4                teacher  47745</span></span>
<span><span class="co">## 5            woman.smoke 119438</span></span>
<span><span class="co">## 6                 priest   1004</span></span>
<span><span class="co">## 7       woman.gave.birth 256164</span></span>
<span><span class="co">## 8                 muslim 195449</span></span>
<span><span class="co">## 9           incarcerated  68000</span></span>
<span><span class="co">## 10          man.divorced  50698</span></span>
<span><span class="co">## 11            nsengimana  32528</span></span>
<span><span class="co">## 12            murekatete  30531</span></span>
<span><span class="co">## 13              twahirwa  10420</span></span>
<span><span class="co">## 14           mukandekezi  10520</span></span>
<span><span class="co">## 15             nsabimana  48560</span></span>
<span><span class="co">## 16              mukamana  51449</span></span>
<span><span class="co">## 17            ndayambaje  22724</span></span>
<span><span class="co">## 18             nyiraneza  21705</span></span>
<span><span class="co">## 19              bizimana  38497</span></span>
<span><span class="co">## 20         nyirahabimana  42727</span></span>
<span><span class="co">## 21           ndagijimana  37375</span></span>
<span><span class="co">## 22        mukandayisenga  35055</span></span></code></pre>
<p><code>example.knownpop.dat</code> is very simple: one column has a
name for each known population, and the other has its toal size. We
expect that users will typically start with a small dataset like this
one. When using the <code>networkreporting</code> package, it is more
useful to have a vector whose entries are known population sizes and
whose names are the known population names. The <code>df.to.kpvec</code>
function makes it easy for us to create it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kp.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/df.to.kpvec.html">df.to.kpvec</a></span><span class="op">(</span><span class="va">example.knownpop.dat</span>, kp.var<span class="op">=</span><span class="st">"known.popn"</span>, kp.value<span class="op">=</span><span class="st">"size"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kp.vec</span></span></code></pre></div>
<pre><code><span><span class="co">##               widower       nurse.or.doctor male.community.health </span></span>
<span><span class="co">##                 36147                  7807                 22000 </span></span>
<span><span class="co">##               teacher           woman.smoke                priest </span></span>
<span><span class="co">##                 47745                119438                  1004 </span></span>
<span><span class="co">##      woman.gave.birth                muslim          incarcerated </span></span>
<span><span class="co">##                256164                195449                 68000 </span></span>
<span><span class="co">##          man.divorced            nsengimana            murekatete </span></span>
<span><span class="co">##                 50698                 32528                 30531 </span></span>
<span><span class="co">##              twahirwa           mukandekezi             nsabimana </span></span>
<span><span class="co">##                 10420                 10520                 48560 </span></span>
<span><span class="co">##              mukamana            ndayambaje             nyiraneza </span></span>
<span><span class="co">##                 51449                 22724                 21705 </span></span>
<span><span class="co">##              bizimana         nyirahabimana           ndagijimana </span></span>
<span><span class="co">##                 38497                 42727                 37375 </span></span>
<span><span class="co">##        mukandayisenga </span></span>
<span><span class="co">##                 35055</span></span></code></pre>
<p>Finally, we also need to know the total size of the population we are
making estimates about. In this case, let’s assume that we’re working in
a country of 10 million people:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total size of the population</span></span>
<span><span class="va">tot.pop.size</span> <span class="op">&lt;-</span> <span class="fl">10e6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-the-survey-data">Preparing the survey data<a class="anchor" aria-label="anchor" href="#preparing-the-survey-data"></a>
</h3>
<p>Now let’s take a look at the demo survey dataset, which is called
<code>example.survey</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">example.survey</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      id cluster      region indweight  sex age.cat widower nurse.or.doctor</span></span>
<span><span class="co">## 1 1.1.1       1 Kigali City  0.330602 Male [25,35)       3               2</span></span>
<span><span class="co">## 2 1.1.2       1 Kigali City  0.330602 Male [25,35)       0               2</span></span>
<span><span class="co">## 3 1.1.3       1 Kigali City  0.330602 Male [25,35)       2               8</span></span>
<span><span class="co">## 4 1.1.4       1 Kigali City  0.330602 Male [25,35)       0               1</span></span>
<span><span class="co">## 5 1.1.5       1 Kigali City  0.330602 Male [25,35)       0               0</span></span>
<span><span class="co">## 6 1.1.6       1 Kigali City  0.330602 Male [25,35)       7               4</span></span>
<span><span class="co">##   male.community.health teacher woman.smoke priest civil.servant</span></span>
<span><span class="co">## 1                     1       5           1      0             5</span></span>
<span><span class="co">## 2                     1       5           0      0             5</span></span>
<span><span class="co">## 3                     0       3           0      0            50</span></span>
<span><span class="co">## 4                     0       0           0      0             5</span></span>
<span><span class="co">## 5                     0       0           0      0             5</span></span>
<span><span class="co">## 6                     0       8           2      0             6</span></span>
<span><span class="co">##   woman.gave.birth muslim incarcerated judge man.divorced treatedfortb</span></span>
<span><span class="co">## 1                3      4            2     3            2            0</span></span>
<span><span class="co">## 2                3      0            2     3            1            0</span></span>
<span><span class="co">## 3                4      3            0     0            2            0</span></span>
<span><span class="co">## 4                0      0            0     0            0            0</span></span>
<span><span class="co">## 5                0      0            0     0            1            0</span></span>
<span><span class="co">## 6                3      4            3     0            1            0</span></span>
<span><span class="co">##   nsengimana murekatete twahirwa mukandekezi nsabimana mukamana ndayambaje</span></span>
<span><span class="co">## 1          0          0        2           1         2        3          1</span></span>
<span><span class="co">## 2          3          2        0           0         1        0          0</span></span>
<span><span class="co">## 3          0          0        0           1         2        0          0</span></span>
<span><span class="co">## 4          1          0        0           0         0        0          0</span></span>
<span><span class="co">## 5          0          0        0           0         0        0          0</span></span>
<span><span class="co">## 6          1          1        0           0         0        0          0</span></span>
<span><span class="co">##   nyiraneza bizimana nyirahabimana ndagijimana mukandayisenga died sex.workers</span></span>
<span><span class="co">## 1         0        2             0           1              0    0           0</span></span>
<span><span class="co">## 2         0        0             0           0              0    1           0</span></span>
<span><span class="co">## 3         0        0             0           0              0    2           0</span></span>
<span><span class="co">## 4         0        0             0           0              0    0           0</span></span>
<span><span class="co">## 5         0        0             0           0              0    0           0</span></span>
<span><span class="co">## 6         0        0             0           0              0    4           0</span></span>
<span><span class="co">##   msm idu clients</span></span>
<span><span class="co">## 1   0   0       2</span></span>
<span><span class="co">## 2   0   0       1</span></span>
<span><span class="co">## 3   0   0       0</span></span>
<span><span class="co">## 4   0   0       0</span></span>
<span><span class="co">## 5   0   0       0</span></span>
<span><span class="co">## 6   0   0      10</span></span></code></pre>
<p>The columns fall into a few categories:</p>
<ul>
<li>an id variable for each respondent: <code>id</code>
</li>
<li>information related to the sampling design of the survey:
<code>cluster</code>, <code>region</code>, and
<code>indweight</code>.</li>
<li>demographic characteristics of the respondents: <code>sex</code> and
<code>age.cat</code>
</li>
<li>responses to questiona bout populations whose total size is known:
<code>widower</code>, …, <code>mukandayisenga</code>
</li>
<li>questions about hidden populations: <code>died</code>, …,
<code>clients</code>
</li>
</ul>
<p>This is the general form that your survey dataset should have.</p>
<div class="section level4">
<h4 id="topcoding">Topcoding<a class="anchor" aria-label="anchor" href="#topcoding"></a>
</h4>
<p>Many network scale-up studies have topcoded the responses to the
aggregate relational data questions. This means that researchers
considered any responses above a certain value, called the topcode, to
be implausible. Before proceeding with the analysis, researchers
substitute the maximum plausible value in for the implausible ones. For
example, in many studies, researchers replaced responses with the value
31 or higher with the value 30 before conducting their analysis (see
Zheng, Salganik, and Gelman 2006).</p>
<p>We won’t discuss whether or not this is advisable here, but this is
currently a common practice in scale-up studies. If you wish to follow
it, you can use the <code>topcode.data</code> function. For example,
let’s topcode the responses to the questions about populations of known
size to the value 30. First, we’ll examine the distribution of the
responses before topcoding:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make a vector with the list of known population names from</span></span>
<span><span class="co">## our dataset of known population totals</span></span>
<span><span class="va">known.popn.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">example.knownpop.dat</span><span class="op">$</span><span class="va">known.popn</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## before topcoding: max. response for several popns is &gt; 30</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example.survey</span><span class="op">[</span>,<span class="va">known.popn.vars</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     widower        nurse.or.doctor   male.community.health    teacher      </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.000        Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.000        1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median : 0.000        Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 0.6101   Mean   : 0.5112   Mean   : 0.724        Mean   : 1.356  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.: 1.000        3rd Qu.: 1.000  </span></span>
<span><span class="co">##  Max.   :95.0000   Max.   :40.0000   Max.   :95.000        Max.   :95.000  </span></span>
<span><span class="co">##                                                                            </span></span>
<span><span class="co">##   woman.smoke         priest        woman.gave.birth     muslim      </span></span>
<span><span class="co">##  Min.   : 0.000   Min.   : 0.0000   Min.   : 0.000   Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.000   1st Qu.: 0.0000   1st Qu.: 0.000   1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.000   Median : 0.0000   Median : 1.000   Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 1.022   Mean   : 0.1484   Mean   : 1.885   Mean   : 2.094  </span></span>
<span><span class="co">##  3rd Qu.: 1.000   3rd Qu.: 0.0000   3rd Qu.: 3.000   3rd Qu.: 1.000  </span></span>
<span><span class="co">##  Max.   :95.000   Max.   :25.0000   Max.   :30.000   Max.   :95.000  </span></span>
<span><span class="co">##                                                      NA's   :1       </span></span>
<span><span class="co">##   incarcerated      man.divorced       nsengimana       murekatete     </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   :0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.:0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median :0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.4347   Mean   : 0.3367   Mean   :0.3603   Mean   : 0.3425  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.:0.0000   3rd Qu.: 1.0000  </span></span>
<span><span class="co">##  Max.   :95.0000   Max.   :20.0000   Max.   :8.0000   Max.   :12.0000  </span></span>
<span><span class="co">##                                                                        </span></span>
<span><span class="co">##     twahirwa        mukandekezi      nsabimana          mukamana      </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   :0.000   Min.   : 0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.:0.000   1st Qu.: 0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median :0.000   Median : 0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.2394   Mean   :0.165   Mean   : 0.4705   Mean   : 0.4144  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.:0.000   3rd Qu.: 1.0000   3rd Qu.: 1.0000  </span></span>
<span><span class="co">##  Max.   :10.0000   Max.   :7.000   Max.   :20.0000   Max.   :15.0000  </span></span>
<span><span class="co">##                                                                       </span></span>
<span><span class="co">##    ndayambaje        nyiraneza          bizimana       nyirahabimana   </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median : 0.0000   Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 0.3296   Mean   : 0.2685   Mean   : 0.4331   Mean   : 0.261  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.: 1.0000   3rd Qu.: 0.000  </span></span>
<span><span class="co">##  Max.   :30.0000   Max.   :10.0000   Max.   :12.0000   Max.   :17.000  </span></span>
<span><span class="co">##                                                                        </span></span>
<span><span class="co">##   ndagijimana      mukandayisenga   </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.3279   Mean   : 0.2577  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000  </span></span>
<span><span class="co">##  Max.   :10.0000   Max.   :20.0000  </span></span>
<span><span class="co">## </span></span></code></pre>
<p>Several populations, including <code>widower</code>,
<code>male.community.health</code>, <code>teacher</code>,
<code>woman.smoke</code>, <code>muslim</code>, and
<code>incarcerated</code> have maximum values that are very high. (It
turns out that 95 is the highest value that could be recorded during the
interviews; if respondents said that they were connected to more than 95
people in the group, the interviewers wrote 95 down.)</p>
<p>Now we use the <code>topcode.data</code> function to topcode all of
the responses at 30:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example.survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topcode.data.html">topcode.data</a></span><span class="op">(</span><span class="va">example.survey</span>,</span>
<span>                               vars<span class="op">=</span><span class="va">known.popn.vars</span>,</span>
<span>                               max<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## after topcoding: max. response for all popns is 30</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example.survey</span><span class="op">[</span>,<span class="va">known.popn.vars</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     widower        nurse.or.doctor   male.community.health    teacher      </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.000        Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.000        1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median : 0.000        Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 0.5831   Mean   : 0.5062   Mean   : 0.653        Mean   : 1.216  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.: 1.000        3rd Qu.: 1.000  </span></span>
<span><span class="co">##  Max.   :30.0000   Max.   :30.0000   Max.   :30.000        Max.   :30.000  </span></span>
<span><span class="co">##                                                                            </span></span>
<span><span class="co">##   woman.smoke          priest        woman.gave.birth     muslim      </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.000   Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.000   1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median : 1.000   Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 0.9638   Mean   : 0.1484   Mean   : 1.885   Mean   : 1.468  </span></span>
<span><span class="co">##  3rd Qu.: 1.0000   3rd Qu.: 0.0000   3rd Qu.: 3.000   3rd Qu.: 1.000  </span></span>
<span><span class="co">##  Max.   :30.0000   Max.   :25.0000   Max.   :30.000   Max.   :30.000  </span></span>
<span><span class="co">##                                                       NA's   :1       </span></span>
<span><span class="co">##   incarcerated      man.divorced       nsengimana       murekatete     </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   :0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.:0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median :0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.3807   Mean   : 0.3367   Mean   :0.3603   Mean   : 0.3425  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.:0.0000   3rd Qu.: 1.0000  </span></span>
<span><span class="co">##  Max.   :30.0000   Max.   :20.0000   Max.   :8.0000   Max.   :12.0000  </span></span>
<span><span class="co">##                                                                        </span></span>
<span><span class="co">##     twahirwa        mukandekezi      nsabimana          mukamana      </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   :0.000   Min.   : 0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.:0.000   1st Qu.: 0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median :0.000   Median : 0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.2394   Mean   :0.165   Mean   : 0.4705   Mean   : 0.4144  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.:0.000   3rd Qu.: 1.0000   3rd Qu.: 1.0000  </span></span>
<span><span class="co">##  Max.   :10.0000   Max.   :7.000   Max.   :20.0000   Max.   :15.0000  </span></span>
<span><span class="co">##                                                                       </span></span>
<span><span class="co">##    ndayambaje        nyiraneza          bizimana       nyirahabimana   </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.0000   Min.   : 0.000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.0000   1st Qu.: 0.000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000   Median : 0.0000   Median : 0.000  </span></span>
<span><span class="co">##  Mean   : 0.3296   Mean   : 0.2685   Mean   : 0.4331   Mean   : 0.261  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000   3rd Qu.: 1.0000   3rd Qu.: 0.000  </span></span>
<span><span class="co">##  Max.   :30.0000   Max.   :10.0000   Max.   :12.0000   Max.   :17.000  </span></span>
<span><span class="co">##                                                                        </span></span>
<span><span class="co">##   ndagijimana      mukandayisenga   </span></span>
<span><span class="co">##  Min.   : 0.0000   Min.   : 0.0000  </span></span>
<span><span class="co">##  1st Qu.: 0.0000   1st Qu.: 0.0000  </span></span>
<span><span class="co">##  Median : 0.0000   Median : 0.0000  </span></span>
<span><span class="co">##  Mean   : 0.3279   Mean   : 0.2577  </span></span>
<span><span class="co">##  3rd Qu.: 0.0000   3rd Qu.: 0.0000  </span></span>
<span><span class="co">##  Max.   :10.0000   Max.   :20.0000  </span></span>
<span><span class="co">## </span></span></code></pre>
<p>If you look at the help page for <code>topcode.data</code>, you’ll
see that it can also handle situations where the variables can take on
special codes for missing values, refusals, and so forth.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="estimating-network-sizes">Estimating network sizes<a class="anchor" aria-label="anchor" href="#estimating-network-sizes"></a>
</h2>
<p>Now that we have finished preparing the data, we turn to esimating
the sizes of each respondent’s personal network. To do this using the
known population estimator, we use the <code>kp.degree.estimator</code>
function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d.hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kp.individual.estimator.html">kp.individual.estimator_</a></span><span class="op">(</span>resp.data<span class="op">=</span><span class="va">example.survey</span>,</span>
<span>                                  known.populations<span class="op">=</span><span class="va">known.popn.vars</span>,</span>
<span>                                  total.kp.size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">kp.vec</span><span class="op">)</span>,</span>
<span>                                  alter.popn.size<span class="op">=</span><span class="va">tot.pop.size</span><span class="op">)</span><span class="op">$</span><span class="va">dbar.Fcell.F</span></span></code></pre></div>
<pre><code><span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d.hat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##    0.00   25.28   58.99  101.21  126.42 1904.69</span></span></code></pre>
<p>We can examine the results with a histogram</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># we'll use qplot from ggplot2 for plots</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">d.hat</span>, binwidth<span class="op">=</span><span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `qplot()` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="network_scaleup_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
<p>Now let’s append the degree estimates to the survey reports
dataframe:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example.survey</span><span class="op">$</span><span class="va">d.hat</span> <span class="op">&lt;-</span> <span class="va">d.hat</span></span></code></pre></div>
<!--
### Missing data in known population questions

For now, we do not explicitly address missing data in the reported connections to the known
populations. Future versions of the package may include tools to help address this issue.
-->
</div>
<div class="section level2">
<h2 id="estimating-hidden-population-size">Estimating hidden population size<a class="anchor" aria-label="anchor" href="#estimating-hidden-population-size"></a>
</h2>
<p>Now that you have estimated degrees, you can use them to produce
estimates of the size of the hidden population. Here, we’ll take the
example of clients of female sex workers, <code>clients</code></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idu.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nsum.estimator.html">nsum.estimator</a></span><span class="op">(</span>survey.data<span class="op">=</span><span class="va">example.survey</span>,</span>
<span>                          d.hat.vals<span class="op">=</span><span class="va">d.hat</span>,</span>
<span>                          total.popn.size<span class="op">=</span><span class="va">tot.pop.size</span>,</span>
<span>                          y.vals<span class="op">=</span><span class="st">"clients"</span>,</span>
<span>                          missing<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span></span></code></pre></div>
<p>Note that we had to specify that we should use only rows in our
dataset with no missing values through the
<code>missing = "complete.obs"</code> option, and also that we had to
pass in the total population size using the <code>total.popn.size</code>
option. The resulting estimate is</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idu.est</span></span></code></pre></div>
<pre><code><span><span class="co">## $estimate</span></span>
<span><span class="co">## [1] 47798.44</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $tot.connections</span></span>
<span><span class="co">## [1] 1164</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sum.d.hat</span></span>
<span><span class="co">## [1] 243522.6</span></span></code></pre>
<p>This returns the estimate, and also the numerator and denominator
used to compute it.</p>
</div>
<div class="section level2">
<h2 id="variance-estimation">Variance estimation<a class="anchor" aria-label="anchor" href="#variance-estimation"></a>
</h2>
<p>In order to estimate the sampling uncertainty of our estimated
totals, we can use the rescaled bootstrap technique; see Feehan and
Salganik 2016 for more about the rescaled boostrap and how it can be
applied to the network scale-up method. In order to use the rescaled
boostrap, you need to be able to specify the sampling design of your
study. In particular, you need to be able to describe the stratifcation
(if any) and the primary sampling units used in the study.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idu.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/surveybootstrap/man/bootstrap.estimates.html" class="external-link">bootstrap.estimates</a></span><span class="op">(</span><span class="co">## this describes the sampling design of the</span></span>
<span>                               <span class="co">## survey; here, the PSUs are given by the</span></span>
<span>                               <span class="co">## variable cluster, and the strata are given</span></span>
<span>                               <span class="co">## by the variable region</span></span>
<span>                               survey.design <span class="op">=</span> <span class="op">~</span> <span class="va">cluster</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,</span>
<span>                               <span class="co">## the number of bootstrap resamples to obtain</span></span>
<span>                               <span class="co">## (NOTE: in practice, you should use more than 100.</span></span>
<span>                               <span class="co">##  this keeps building the package relatively fast)</span></span>
<span>                               num.reps<span class="op">=</span><span class="fl">100</span>,</span>
<span>                               <span class="co">## this is the name of the function</span></span>
<span>                               <span class="co">## we want to use to produce an estimate</span></span>
<span>                               <span class="co">## from each bootstrapped dataset</span></span>
<span>                               estimator.fn<span class="op">=</span><span class="st">"nsum.estimator"</span>,</span>
<span>                               <span class="co">## these are the sampling weights</span></span>
<span>                               weights<span class="op">=</span><span class="st">"indweight"</span>,</span>
<span>                               <span class="co">## this is the name of the type of bootstrap</span></span>
<span>                               <span class="co">## we wish to use</span></span>
<span>                               bootstrap.fn<span class="op">=</span><span class="st">"rescaled.bootstrap.sample"</span>,</span>
<span>                               <span class="co">## our dataset</span></span>
<span>                               survey.data<span class="op">=</span><span class="va">example.survey</span>,</span>
<span>                               <span class="co">## other parameters we need to pass</span></span>
<span>                               <span class="co">## to the nsum.estimator function</span></span>
<span>                               d.hat.vals<span class="op">=</span><span class="va">d.hat</span>,</span>
<span>                               total.popn.size<span class="op">=</span><span class="va">tot.pop.size</span>,</span>
<span>                               y.vals<span class="op">=</span><span class="st">"clients"</span>,</span>
<span>                               missing<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Unquoting language objects with `!!!` is deprecated as of rlang 0.4.0. Please</span></span>
<span><span class="co">## use `!!` instead.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## # Bad: dplyr::select(data, !!!enquo(x))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## # Good: dplyr::select(data, !!enquo(x)) # Unquote single quosure</span></span>
<span><span class="co">## dplyr::select(data, !!!enquos(x)) # Splice list of quosures</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span></code></pre>
<p>By default, <code>bootstrap.estimates</code> produces a list with
<code>num.reps</code> entries; each entry is the result of calling the
estimator function on one bootstrap resample.</p>
<p>Next, you can write a bit of code that will help us put all of these
results together, for plotting and summarizing</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span></span>
<span><span class="co">## combine the estimates together in one data frame</span></span>
<span><span class="co">## (bootstrap.estimates gives us a list)</span></span>
<span><span class="va">all.idu.estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html" class="external-link">ldply</a></span><span class="op">(</span><span class="va">idu.est</span>,</span>
<span>                           <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>estimate<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can examine the summarized results with a histogram or with
<code>summarize</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## look at a histogram of the results</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">all.idu.estimates</span><span class="op">$</span><span class="va">estimate</span>, binwidth<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_scaleup_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## summarize the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">all.idu.estimates</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##   27067   32759   35606   35465   37922   46234</span></span></code></pre>
<p>To produce 95% intervals using the percentile method you can do
something like this</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">all.idu.estimates</span><span class="op">$</span><span class="va">estimate</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     2.5%    97.5% </span></span>
<span><span class="co">## 28318.34 43474.41</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="internal-consistency-checks">Internal consistency checks<a class="anchor" aria-label="anchor" href="#internal-consistency-checks"></a>
</h2>
<p>If you want to run internal consistency checks (see e.g. <a href="https://doi.org/10.1093/aje/kwv287" class="external-link">Feehan et al., 2016, Fig
3</a>), you can use the <code>nsum.internal.consistency</code> function.
We specify that we wish to use only complete observations (ie, we will
remove rows that have any missing values from our calculations).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ic.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nsum.internal.consistency.html">nsum.internal.consistency</a></span><span class="op">(</span>survey.data<span class="op">=</span><span class="va">example.survey</span>,</span>
<span>                                      known.popns<span class="op">=</span><span class="va">kp.vec</span>,</span>
<span>                                      missing<span class="op">=</span><span class="st">"complete.obs"</span>,</span>
<span>                                      killworth.se<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                      total.popn.size<span class="op">=</span><span class="va">tot.pop.size</span>,</span>
<span>                                      alter.popn.size<span class="op">=</span><span class="va">tot.pop.size</span>,</span>
<span>                                      kp.method<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                      return.plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## NOTE: Ignoring any rows with missingness on any of the report variables.</span></span></code></pre>
<p>Now <code>ic.result</code> is a list that has a summary of the
results in the entry <code>results</code></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ic.result</span><span class="op">$</span><span class="va">results</span></span></code></pre></div>
<pre><code><span><span class="co">##                     name nsum.holdout.est known.size d.hat.sum killworth.se</span></span>
<span><span class="co">## 1                widower         58708.19      36147  238978.6    1562.7564</span></span>
<span><span class="co">## 2        nurse.or.doctor         51873.41       7807  234802.4    1482.4902</span></span>
<span><span class="co">## 3  male.community.health         66955.68      22000  234632.8    1683.6063</span></span>
<span><span class="co">## 4                teacher        128262.77      47745  228047.5    2356.3211</span></span>
<span><span class="co">## 5            woman.smoke         93114.71     119438  249047.7    1924.5823</span></span>
<span><span class="co">## 6                 priest         14830.66       1004  240717.5     784.3396</span></span>
<span><span class="co">## 7       woman.gave.birth        173204.79     256164  261828.8    2549.6303</span></span>
<span><span class="co">## 8                 muslim        137934.15     195449  255929.3    2305.5174</span></span>
<span><span class="co">## 9           incarcerated         36619.80      68000  250137.9    1207.7348</span></span>
<span><span class="co">## 10          man.divorced         32758.93      50698  247260.8    1149.1445</span></span>
<span><span class="co">## 11            nsengimana         35697.55      32528  242873.8    1210.1866</span></span>
<span><span class="co">## 12            murekatete         33933.74      30531  242826.2    1180.1303</span></span>
<span><span class="co">## 13              twahirwa         23921.99      10420  240782.6     995.5567</span></span>
<span><span class="co">## 14           mukandekezi         16382.94      10520  242325.2     821.5626</span></span>
<span><span class="co">## 15             nsabimana         46399.77      48560  243966.7    1375.8868</span></span>
<span><span class="co">## 16              mukamana         40565.23      51449  245777.0    1282.1053</span></span>
<span><span class="co">## 17            ndayambaje         32841.38      22724  241463.7    1164.3150</span></span>
<span><span class="co">## 18             nyiraneza         26637.59      21705  242514.4    1046.6453</span></span>
<span><span class="co">## 19              bizimana         42949.20      38497  242612.2    1327.6590</span></span>
<span><span class="co">## 20         nyirahabimana         25411.84      42727  247128.9    1012.7535</span></span>
<span><span class="co">## 21           ndagijimana         32259.79      37375  244576.9    1146.6248</span></span>
<span><span class="co">## 22        mukandayisenga         25249.25      35055  245551.8    1012.7533</span></span>
<span><span class="co">##    killworth.se.wgtdenom        err    abserr      sqerr      relerr</span></span>
<span><span class="co">## 1              1562.7564  22561.191 22561.191  509007341  0.62415113</span></span>
<span><span class="co">## 2              1482.4902  44066.413 44066.413 1941848743  5.64447456</span></span>
<span><span class="co">## 3              1683.6063  44955.682 44955.682 2021013338  2.04344009</span></span>
<span><span class="co">## 4              2356.3211  80517.771 80517.771 6483111367  1.68641262</span></span>
<span><span class="co">## 5              1924.5823 -26323.291 26323.291  692915672  0.22039294</span></span>
<span><span class="co">## 6               784.3396  13826.662 13826.662  191176573 13.77157538</span></span>
<span><span class="co">## 7              2549.6303 -82959.207 82959.207 6882229975  0.32385193</span></span>
<span><span class="co">## 8              2305.5174 -57514.848 57514.848 3307957792  0.29427036</span></span>
<span><span class="co">## 9              1207.7348 -31380.200 31380.200  984716944  0.46147353</span></span>
<span><span class="co">## 10             1149.1445 -17939.074 17939.074  321810359  0.35384184</span></span>
<span><span class="co">## 11             1210.1866   3169.553  3169.553   10046064  0.09744075</span></span>
<span><span class="co">## 12             1180.1303   3402.735  3402.735   11578609  0.11145182</span></span>
<span><span class="co">## 13              995.5567  13501.990 13501.990  182303747  1.29577644</span></span>
<span><span class="co">## 14              821.5626   5862.944  5862.944   34374109  0.55731404</span></span>
<span><span class="co">## 15             1375.8868  -2160.232  2160.232    4666603  0.04448583</span></span>
<span><span class="co">## 16             1282.1053 -10883.772 10883.772  118456503  0.21154488</span></span>
<span><span class="co">## 17             1164.3150  10117.380 10117.380  102361383  0.44522884</span></span>
<span><span class="co">## 18             1046.6453   4932.592  4932.592   24330468  0.22725604</span></span>
<span><span class="co">## 19             1327.6590   4452.195  4452.195   19822041  0.11565044</span></span>
<span><span class="co">## 20             1012.7535 -17315.161 17315.161  299814807  0.40525104</span></span>
<span><span class="co">## 21             1146.6248  -5115.214  5115.214   26165412  0.13686191</span></span>
<span><span class="co">## 22             1012.7533  -9805.749  9805.749   96152722  0.27972470</span></span></code></pre>
<p>Since we passed the argument <code>return.plot=TRUE</code> to the
function, we also get a plot:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ic.result</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_scaleup_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" alt="" width="700"></p>
<p>This plot is a <code>ggplot2</code> object, so we can customize it if
we want. As a very simple example, we can change the title:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ic.result</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"internal consistency checks"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_scaleup_files/figure-html/unnamed-chunk-21-1.png" class="r-plt" alt="" width="700"></p>
<p>The <a href="http://ggplot2.org/" class="external-link">ggplot2 website</a> has more
information on modifying ggplot2 objects.</p>
<!--
Attaching known population totals to the dataframe
--------------------------------------------------

Several of the functions we demonstrated above required us to pass in
the vector containing the known population sizes and also the size of
the total population.  We can avoid this step by attaching these two
pieces of information to the survey dataframe using the `add.kp` function:


``` r
example.survey <- add.kp(example.survey, kp.vec, tot.pop.size)

d.hat.new <- kp.degree.estimator(survey.data=example.survey,
                                 # we don't need this anymore, since we
                                 # them to survey.data's attributes using add.kp
                                 #known.popns=kp.vec,
                                 #total.popn.size=tot.pop.size,
                                 missing="complete.obs")

summary(d.hat.new)
```

This is exactly the same result we obtained before.
-->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dennis M. Feehan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
